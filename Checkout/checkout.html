<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="device-width" initial-scale=1.0">
        <title>Checkout</title>
        <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
        <link rel="stylesheet" href="style2.css">
    </head>
    <body>
        <h2>Checkout</h2>
        <form>
            <div class="container">
                <div class="form-section">
                    <div class="billing-section">
                        <div class="contact-details">
                            <h3 class="section-heading"><i class='bx bxs-edit-alt' ></i>Contact Details</h3>
                            <div class="error-message hidden">Please fill out the highlighted fields correctly.</div>
                            <label for="name">Full Name :</label>
                            <input type="text" id="name" name="name" placeholder="Enter your name" required>
                            <label for="phone">Phone Number :</label>
                            <input type="tel" id="phone" name="phone" placeholder="Enter your phone number" required>
                            <label for="email">Email :</label>
                            <input type="email" id="email" name="email" placeholder="Enter your email" required>
                            <button type="button" class="save-billing-button">Save </button>
                        </div>
                        <div class="billing-address">
                            <h3 class="section-heading"><i class='bx bxs-edit-alt' ></i>Billing Address</h3>
                            <div class="error-message hidden">Please fill out the highlighted fields correctly.</div>
                            <label for="address">Address :</label>
                            <input type="text" id="address" name="address" placeholder="Enter your address" required>
                            <label for="city">City :</label>
                            <input type="text" id="city" name="city" placeholder="Enter your city" required>
                            <label for="region">Region :</label>
                            <input type="text" id="region" name="region" placeholder="Enter your region (State/Province)" required>
                            <label for="country">Country :</label>
                            <input type="text" id="country" name="country" placeholder="Enter your country" required>
                            <label for="zip">Zip/Post Code :</label>
                            <input type="text" id="zip" name="zip" placeholder="Enter your zip/post code" required>
                            <button type="button" class="save-billing-button">Save </button>
                        </div>
                        
                    </div>

                    <div class="payment-section">
                        <h3 class="section-heading"><i class='bx bxs-edit-alt' ></i>Payment</h3>
                        <div class="error-message hidden">Please fill out the highlighted fields correctly.</div>
                        <label>Accepted Cards :</label>
                        <div class="card-icons">
                            <i class='bx bxl-visa'></i>
                            <i class='bx bxl-mastercard'></i>
                        </div>
                        <label for="cardtype">Card Type :</label>
                        <select id="cardtype" name="cardtype">
                            <option value="visa">Visa</option>
                            <option value="mastercard">Mastercard</option>
                        </select>
                        <label for="cardname">Name on card :</label>
                        <input type="text" id="cardname" name="cardname" placeholder="Enter name on the card" required>
                        <label for="cardnumber">Card number :</label>
                        <input type="text" id="cardnumber" name="cardnumber" placeholder="Enter card number" required>
                        <label for="expdate">Expiry Date :</label>
                        <input type="text" id="expdate" name="expdate" placeholder="Enter expiry date" required>
                        <label for="cvv">CVV :</label>
                        <input type="text" id="cvv" name="cvv" placeholder="Enter CVV" required>
                        <button type="button" class="save-payment-button">Save </button>
                        
                    </div>
                </div>

                <div class="order-section">
                    <h3>Order Summary</h3>
                    <div class="detail-summary"></div>
                    <p class="total">Total: $0</p>
                    <button class="pay-button" type="button" disabled>Fill the details to pay</button>
                    <div class="payment-cofirmation hidden"><i class='bx bx-check' style='color:green'  ></i>Payment Successful. Redirecting to home page.</div>
                </div>
            </div>
        </form>
            
        <script>
          function getDetailsFromURL() {
            // Get the URL parameters
            let params = new URLSearchParams(window.location.search);
            // Get the details from the URL parameters
            let name = params.get("name");
            let email = params.get("email");
            let totalValue = params.get("total");

            // Get the input elements and the total p element
            let nameInput = document.querySelector("#name");
            let emailInput = document.querySelector("#email");
            let total = document.querySelector(".total");

            // Set the value of the input elements and the total p element
            nameInput.value = name;
            emailInput.value = email;
            total.textContent = "Total: $" + totalValue;
          };

          getDetailsFromURL();


          // Get all the buttons with the class name save-billing-button or save-payment-button
          let buttons = document.querySelectorAll(".save-billing-button, .save-payment-button");

          // Get the detail-summary div
          let detailSummary = document.querySelector(".detail-summary");

          // Get the pay-button
          let payButton = document.querySelector(".pay-button");

          function checkSummary() {
            // If all the summary p tags have text content, enable the button and change the text to "Pay"
            if (nameSummary.textContent && contactSummary.textContent && addressSummary.textContent) {
              payButton.disabled = false;
              payButton.textContent = "Pay";
            } else {
              // If any of the summary p tags is empty, disable the button and change the text to "Fill the details to pay"
              payButton.disabled = true;
              payButton.textContent = "Fill the details to pay";
            }
          }

          payButton.addEventListener("click", function() {
            // If the button is enabled, show the payment confirmation message and redirect to the home page after 3 seconds
            if (!payButton.disabled) {
              payButton.classList.add("hidden");
              let paymentConfirmation = document.querySelector(".payment-cofirmation");
              paymentConfirmation.classList.remove("hidden");
              setTimeout(function() {
                window.location.href = "../Store/Store.html";
              }, 3000);
            }
          });

          

          // Create three p elements with classes name-summary, contact-summary, address-summary and payment-summary and append them to the detail-summary div
          let nameSummary = document.createElement("p");
          nameSummary.className = "name-summary hidden";
          detailSummary.appendChild(nameSummary);

          let contactSummary = document.createElement("p");
          contactSummary.className = "contact-summary hidden";
          detailSummary.appendChild(contactSummary);

          let addressSummary = document.createElement("p");
          addressSummary.className = "address-summary hidden";
          detailSummary.appendChild(addressSummary);

          let paymentSummary = document.createElement("p");
          paymentSummary.className = "payment-summary hidden";
          detailSummary.appendChild(paymentSummary);

          // Loop through the buttons and add a click event listener to each one
          buttons.forEach(function(button) {
            button.addEventListener("click", function() {
              // Get the parent div of the button
              let parentDiv = button.parentElement;
              // Get all the children of the parent div
              let children = parentDiv.children;
              // Initialize a variable to store the validation status
              let valid = true;
              // Loop through the children and validate them if they are not the section-heading
              for (let i = 0; i < children.length; i++) {
                let child = children[i];
                if (child.className !== "section-heading") {
                  // Validate the input value if it is an input element
                  if (child.tagName === "INPUT") {
                    // If any validation fails, set valid to false
                    if (!validateInput(child)) {
                      valid = false;
                    } else {
                      // If validation passes, remove the class .invalid from the input and add the class .valid
                      child.classList.remove("invalid");
                      child.classList.add("valid");
                    }
                  }
                }
              }
              if (valid) {
                checkSummary();
                for (let i = 0; i < children.length; i++) {
                  let child = children[i];
                  if (child.className !== "section-heading") {
                    // Hide the element by adding the class .hidden
                    child.classList.add("hidden");

                    if (child.name === "name") {
                      nameSummary.textContent = "Name: " + child.value;
                      nameSummary.classList.remove("hidden");
                    }
                    if (child.name === "email") {
                      contactSummary.textContent = "Email: " + child.value;
                      contactSummary.classList.remove("hidden");
                    }
                    if (child.name === "address") {
                      addressSummary.textContent = "Address: " + child.value;
                      addressSummary.classList.remove("hidden");
                    }
                    if (child.name === "cardnumber") {
                      paymentSummary.textContent = "Card Number: " + child.value;
                      paymentSummary.classList.remove("hidden");
                    }
                  }
                }

              }
            });
          });


          let inputs = document.querySelectorAll("input");


          inputs.forEach(function(input) {
            input.addEventListener("input", function() {

              validateInput(input);
            });
          });


          let headings = document.querySelectorAll(".section-heading");

          headings.forEach(function(heading) {
            heading.addEventListener("click", function() {

              let parentDiv = heading.parentElement;

              let children = parentDiv.children;


              for (let i = 0; i < children.length; i++) {
                let child = children[i];
                child.classList.remove("hidden");
              }
              if (heading.textContent === "Billing Address") {
                addressSummary.textContent = "";
              }
              if (heading.textContent === "Contact Details") {
                contactSummary.textContent = "";
                nameSummary.textContent = "";
              }
              if (heading.textContent === "Payment") {
                paymentSummary.textContent = "";
              }
            });
          });


          function validateInput(input) {

            let name = input.name;
            let value = input.value;

            let emailRegex = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/;

            let cardNumberRegex = /^\d{16}$/;

            let cvvRegex = /^\d{3}$/;

            let phoneRegex = /^\d{10}$/;

            let errorMessage = input.parentElement.querySelector(".error-message");

            if (value === "") {
              input.classList.add("invalid");
              input.classList.remove("valid");
              errorMessage.classList.remove("hidden");
              return false;
            } else {
              input.classList.remove("invalid");
              input.classList.add("valid");
              errorMessage.classList.add("hidden");
            }

            if (name === "email") {
              if (!emailRegex.test(value)) {
                input.classList.add("invalid");
                input.classList.remove("valid");
                errorMessage.classList.remove("hidden");
                return false;
              } else {
                input.classList.remove("invalid");
                input.classList.add("valid");
                errorMessage.classList.add("hidden");
              }
            }

            if (name === "cardnumber") {
              if (!cardNumberRegex.test(value)) {
                input.classList.add("invalid");
                input.classList.remove("valid");
                errorMessage.classList.remove("hidden");
                return false;
              } else {
                input.classList.remove("invalid");
                input.classList.add("valid");
                errorMessage.classList.add("hidden");
              }
            }

            if (name === "cvv") {
              if (!cvvRegex.test(value)) {
                input.classList.add("invalid");
                input.classList.remove("valid");
                errorMessage.classList.remove("hidden");
                return false;
              } else {
                input.classList.remove("invalid");
                input.classList.add("valid");
                errorMessage.classList.add("hidden");
              }
            }

            if (name === "phone") {
              if (!phoneRegex.test(value)) {
                input.classList.add("invalid");
                input.classList.remove("valid");
                errorMessage.classList.remove("hidden");
                return false;
              } else {
                input.classList.remove("invalid");
                input.classList.add("valid");
                errorMessage.classList.add("hidden");
              }
            }

            return true;
          }

        </script>
        </body>
        </html>
